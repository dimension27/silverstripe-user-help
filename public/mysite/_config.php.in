<?php
define('NL', "<br />\n");
date_default_timezone_set('@@TIMEZONE@@');

/*
 * Set up environment type, settings and logging.
 */
Director::set_environment_type('@@SS_ENVIRONMENT_TYPE@@');
SS_Log::add_writer(new SS_LogFileWriter('@@ERROR_LOG_FILE@@'), SS_Log::WARN, '<=');
// The following removes the suffixes in dev mode for readability in Firebug
if( Director::isDev() ) {
	Requirements::set_suffix_requirements(false);
	Email::send_all_emails_to('@@DEV_EMAIL@@');
}
else if( Director::isTest() ) {
	BasicAuth::protect_entire_site();
}
else if( Director::isLive() ) {
	SS_Log::add_writer(new SS_LogEmailWriter('errors@dimension27.com'), SS_Log::WARN, '<=');
}

/*
 * Database and project settings, using the ConfigureFromEnv.php approach (see http://bit.ly/euB0Hz)
 */
$GLOBALS['database'] = '@@DB_NAME@@';
global $project;
$project = 'mysite';
require_once('conf/ConfigureFromEnv.php');

/*
 * Various settings.
 */
MySQLDatabase::set_connection_charset('utf8');
SSViewer::set_theme('@@SS_THEME@@');
i18n::set_locale('en_GB');
SiteTree::enable_nested_urls();
GD::set_default_quality(80);
// Object::add_extension('LeftAndMain', 'MyLeftAndMain');
// Object::add_extension('SiteConfig', 'MySiteConfig');
// HideEmail_Controller::set_allowed_domains(array($_SERVER['HTTP_HOST']));

/*
 * Static publisher setup.
 */
// Object::add_extension('SiteTree', 'FilesystemPublisher("cache/", "html")');
// FilesystemPublisher::set_static_base_url(Director::absoluteBaseURL());
// if( class_exists('Subsite') ) { FilesystemPublisher::$domain_based_caching = true; }

/*
 * Enable fulltext searching.
 */
FulltextSearchable::enable();

/*
 * TinyMCE HtmlEditorConfig settings
 */
HtmlEditorConfig::get('cms')->insertButtonsAfter('formatselect', 'removeformat');	
$tinyMCEOptions = array(
		'theme_advanced_blockformats' => 'p,div,h1,h2,h3,h4', 
		// IMPORTANT: no trailing semicolon
		'theme_advanced_styles' => 'Float left=floatLeft;Float right=floatRight', 
		'theme_advanced_path' => 'true',
		'theme_advanced_statusbar_location' => 'bottom',
		'content_css' => Director::baseURL().'themes/'.SSViewer::current_theme().'/css/editor.css'
);
HtmlEditorConfig::get('cms')->setOptions($tinyMCEOptions);
HtmlEditorConfig::get('cms')->enablePlugins('inlinepopups');
// HtmlEditorConfig::get('cms')->setOption('height', '350px');

/*
 * Mollom configuration (if required).
 */
// Mollom::setPublicKey('enter-your-mollom-public-key');
// Mollom::setPrivateKey('enter-your-mollom-private-key');
// SpamProtectorManager::set_spam_protector('MollomSpamProtector');

/*
 * Admin customisation.
 */
// LeftAndMain::setLogo('/path/to/image', 'style');
// LeftAndMain::set_loading_image('/path/to/image');
// LeftAndMain::setApplicationName('/path/to/image');

/*
 * Setup the security key for the Email_BounceHandler
 */
define('EMAIL_BOUNCEHANDLER_KEY', '453616c60bfc87e41c146d3b90b85b9a');
